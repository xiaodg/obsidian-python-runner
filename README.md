# Obsidian Python Runner Plugin

A powerful Obsidian plugin that allows you to run Python code directly in your notes for document analysis, data processing, and chart generation.

**I have no knowledge of TypeScript; the plugin's source code was entirely generated by Windsurf. If you have better implementations, please feel free to modify it.**

**If you have any interesting applications, feel free to share.**


## Installation
### Compile Source Code
1. Download the source code and compile it yourself.
2. Create a new `obsidian-python-runner` directory in the Obsidian plugin directory, and copy the generated `main.js` and `manifest.json` into it.
3. Place the Python code in `obsidian-python-runner/pyscripts`.

### Direct Download
1. Download [latest release](https://github.com/xiaodg/obsidian-python-runner/releases/latest)
2. Unzip it into the Obsidian plugin directory.

## Features

- üöÄ Execute Python code directly in notes
- üìä Generate word clouds and frequency charts
- üìù Analyze document structure and content
- üîç Intelligent text processing
- üé® Automatically generate and insert images
- ‚ö° Quick access to document metadata

## Functionality
This plugin allows users to run Python scripts directly in the Obsidian editor. Users can access various features such as displaying document information, replacing text, and generating visual charts like word clouds and frequency statistics.

## Examples
### Example from `example.py`
- **Function**: `docinfos(doc)`  
  Displays detailed information about the current document, including available fields, title, file path, creation time, modification time, content length, and cursor position.
- **Function**: `replace_text(doc, old_text, new_text)`  
  Replaces specified text in the document content.

### Example from `deepseek.py`
- **Function**: `deepseek_r1(query)`  
  Uses the DeepSeek R1 model to process the query and generate a response based on the provided context.
- **Function**: `deepseek_chat(query)`  
  Uses the DeepSeek Chat model to process the query and generate a response based on the provided context.


## Installation Requirements

1. Latest version of Obsidian
2. Python 3.6 or higher
3. Required Python packages:
   Running the plugin itself does not require any modules to be installed, but if you want to use the example word cloud and frequency chart features, you need to install the following packages:
   - matplotlib==3.7.1
   - wordcloud==1.9.2
   - jieba==0.42.1
   If you want to run the Deepseek API, you need to install the following package:
   - openai==1.5.7

## Usage

### Basic Syntax

Use the `@py` trigger symbol followed by Python function calls in your notes:

Press the Enter key to execute the code, and the result will be automatically inserted into the note.

### Built-in Functions
    The built-in `set_content` function can be used to overwrite the current document content.
    You can refer to the `replace_text` and `add_title` functions in `example.py` for usage.

#### Document Information

```python
# Display detailed information about the current document
@py docinfos(doc)
```
#### Chart Generation

```python
# Generate a word cloud, note the img_path option setting; my image files are placed in the attachments folder under the note directory.
# If different, please change the relevant code in `example.py`
@py generate_word_cloud(doc)
```

### Document Object

Each Python function can access the `doc` object, which contains the following information:

```python
doc = {
    'title': 'Document Title',
    'path': 'File Path',
    'created': 'Creation Timestamp',
    'modified': 'Modification Timestamp',
    'content': 'Full Document Content',
    'frontmatter': 'Front Matter Metadata',
    'cursor': {
        'line': 'Current Line Number',
        'ch': 'Current Column Number'
    },
    'selection': 'Selected Text'
}
```

## Extended Features

### Adding Custom Functions

1. Create a new Python file in the `pyscripts` directory.
2. Define a function that accepts the `doc` parameter.
3. Call the new function using `@py`.
4. Functions that start with an underscore in the `.py` file will not be loaded and cannot be called externally.

For example:

```python
# pyscripts/custom.py
def analyze_sentiment(doc):
    """Analyze document sentiment"""
    # Your code
    return result
```

Then use it in your notes:
```markdown
@py analyze_sentiment(doc)
```


## Settings Options

You can configure the following in the Obsidian settings:

1. Python Path: Specify the location of the Python interpreter.
2. Trigger Symbol: Default is `@py`, which can be customized.

## Frequently Asked Questions

1. **Python Path Error**
   - Ensure Python is installed correctly.
   - Specify the correct Python path in settings.

2. **Package Import Error**
   - Check if all required packages are installed.
   - Run `pip install -r requirements.txt`

3. **Image Generation Failed**
   - Ensure the current directory has write permissions.
   - Check if matplotlib and wordcloud are installed correctly.


## License

MIT License

## Acknowledgments

- Obsidian Team
- Python Community
